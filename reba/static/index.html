<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>REBA評価システム</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>REBA評価システム</h1>

  <div id="calibration">
    <h3>REBA 補正設定</h3>
    <div>
      <p>撮影側 (Filming Side)</p>
      <label><input type="radio" name="filmingSide" value="left" checked> 左側から撮影</label>
      <label><input type="radio" name="filmingSide" value="right"> 右側から撮影</label>
    </div>
    <div>
      <p>頸部: 回旋あり?</p>
      <label><input type="radio" name="neckRotation" value="0" checked> いいえ (+0)</label>
      <label><input type="radio" name="neckRotation" value="1"> はい (+1)</label>
    </div>
    <div>
      <p>頸部: 側屈あり?</p>
      <label><input type="radio" name="neckLateralBending" value="0" checked> いいえ (+0)</label>
      <label><input type="radio" name="neckLateralBending" value="1"> はい (+1)</label>
    </div>
    <div>
      <p>体幹: 側屈あり?</p>
      <label><input type="radio" name="trunkLateralFlexion" value="0" checked> いいえ (+0)</label>
      <label><input type="radio" name="trunkLateralFlexion" value="1"> はい (+1)</label>
    </div>
    <div>
      <p>荷重/力 (Load/Force)</p>
      <label><input type="radio" name="loadForce" value="0" checked> 5kg未満 (+0)</label>
      <label><input type="radio" name="loadForce" value="5"> 5-10kg (+1)</label>
      <label><input type="radio" name="loadForce" value="11"> 10kg超 (+2)</label>
    </div>
     <div>
      <p>作業姿勢 (Posture Category)</p>
      <label><input type="radio" name="postureCategory" value="standingBoth" checked> 立位 - 両足支持</label>
      <label><input type="radio" name="postureCategory" value="standingOne"> 立位 - 片足/不安定</label>
      <label><input type="radio" name="postureCategory" value="sittingWalking"> 座位</label>
    </div>
    <div>
      <p>上腕: 外転または回旋あり?</p>
      <label><input type="radio" name="upperArmCorrection" value="0" checked> いいえ (+0)</label>
      <label><input type="radio" name="upperArmCorrection" value="1"> はい (+1)</label>
    </div>
    <div>
      <p>肩: 挙上あり?</p>
      <label><input type="radio" name="shoulderElevation" value="0" checked> いいえ (+0)</label>
      <label><input type="radio" name="shoulderElevation" value="1"> はい (+1)</label>
    </div>
    <div>
      <p>腕: 支持されている/重力補助あり?</p>
      <label><input type="radio" name="gravityAssist" value="0" checked> いいえ (+0)</label>
      <label><input type="radio" name="gravityAssist" value="-1"> はい (-1)</label>
    </div>
    <div>
      <p>手首: 屈曲/伸展(掌屈/背屈)の角度</p>
      <small>手首の主な曲がり具合を選択してください。</small><br>
      <label><input type="radio" name="wristAngleScore" value="1" checked> 0-15度 (ほぼ真っ直ぐ) [スコア+1]</label>
      <label><input type="radio" name="wristAngleScore" value="2"> 15度超 (曲がっている) [スコア+2]</label>
    </div>
    <div>
      <p>手首: 回旋または橈尺屈あり?</p>
      <label><input type="radio" name="wristCorrection" value="0" checked> いいえ (+0)</label>
      <label><input type="radio" name="wristCorrection" value="1"> はい (+1)</label>
    </div>
    <div>
      <h3>把持の質 (Coupling Score)</h3>
      <small>対象物をどの程度しっかり、快適に持てるかによって追加される点数。</small>
      <ul>
        <li>+0点 (良好 / Good): 快適なグリップ</li>
        <li>+1点 (普通 / Fair): 許容範囲だが理想的でないグリップ</li>
        <li>+2点 (不良 / Poor): 握りにくい、不快なグリップ</li>
        <li>+3点 (不可 / Unacceptable): 非常に持ちにくい、または安全でないグリップ</li>
      </ul>
      <p>Coupling 追加点:</p>
      <label><input type="radio" name="coupling" value="0" checked> +0 (良好)</label>
      <label><input type="radio" name="coupling" value="1"> +1 (普通)</label>
      <label><input type="radio" name="coupling" value="2"> +2 (不良)</label>
      <label><input type="radio" name="coupling" value="3"> +3 (不可)</label>
    </div>
    <div>
       <h3>活動度スコア (Activity Score)</h3>
       <small>以下の項目が1つ以上当てはまる場合、それぞれ+1点を加算。</small>
       <p>1分以上の静止姿勢保持あり?</p>
       <label><input type="radio" name="staticPosture" value="0" checked> いいえ (+0)</label>
       <label><input type="radio" name="staticPosture" value="1"> はい (+1)</label>
       <p>毎分4回以上の反復動作あり?</p>
       <label><input type="radio" name="repetitiveMovement" value="0" checked> いいえ (+0)</label>
       <label><input type="radio" name="repetitiveMovement" value="1"> はい (+1)</label>
       <p>急激/大きな姿勢変化あり?</p>
       <label><input type="radio" name="unstableMovement" value="0" checked> いいえ (+0)</label>
       <label><input type="radio" name="unstableMovement" value="1"> はい (+1)</label>
    </div>
  </div> <div id="results">
    <h3>REBA 評価結果</h3>
    <div id="scoreDisplay">まだ評価されていません</div>
  </div>

  <div id="liveView">
    <button id="webcamButton" disabled>Loading Model...</button>
    <video id="webcam" autoplay playsinline></video>
    <canvas id="output_canvas"></canvas>
  </div>

  <div id="chartContainer" style="margin: 20px auto; max-width: 1024px; background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3>リアルタイムスコア推移</h3>
    <canvas id="rebaChart"></canvas>
    </div>

  <script type="module" src="./script.js"></script>
</body>
</html>
